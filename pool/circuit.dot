digraph {
	rankdir=LR;

	// subgraph cluster_110v {
	// 	label="AC 110v"
		ac110v_line1 [color=orangered];
		ac110v_line2 [color=orangered, style=dashed];
		ac110v_neutral [style=dashed];

		// vsp_pump;
		cleaner_pump;
	// }

	// transformer;

	subgraph cluster_acdc {
		label="acdc";
		dc_5v [color=yellow];
		dc_gnd [color=dimgray];
		ac24v_line [color=blue];
		ac24v_neutral [color=brown];
	}

	// subgraph cluster_24v {
	// 	label="AC 24v";

		subgraph cluster_in_valve {
			label="IN valve";
			in_valve_red [color=red, label="pool"];
			in_valve_white [style=dashed, label="spa"];
			in_valve_black [label="com"];
			in_valve_red -> in_valve_black [color=red];
			in_valve_white -> in_valve_black [style=dashed];
		}
		subgraph cluster_out_valve {
			label="OUT valve";
			out_valve_red [color=red, label="pool"];
			out_valve_white [style=dashed, label="spa"];
			out_valve_black [label="com"];
			out_valve_red -> out_valve_black [color=red, style=dotted];
			out_valve_white -> out_valve_black [style=dotted];
		}

		subgraph cluster_in_switch {
			label="IN switch";
			in_switch_red [color=red, label="pool"];
			in_switch_white [style=dashed, label="spa"];
			in_switch_com [label="com"];

			in_switch_com -> in_switch_red [color=red, style=dotted];
			in_switch_com -> in_switch_white [style=dotted];
		}
		subgraph cluster_out_switch {
			label="OUT switch";
			out_switch_red [color=red, label="pool"];
			out_switch_white [style=dashed, label="spa"];
			out_switch_com [label="com"];

			out_switch_com -> out_switch_red [color=red, style=dotted];
			out_switch_com -> out_switch_white [style=dotted];
		}

		subgraph cluster_stop_switch {
			label="stop_switch";
			stop_switch_com [label="com", color=orange];
			stop_switch_no [label="no", color=orange];

			stop_switch_com -> stop_switch_no [style=dotted, color=orange];
		}
		subgraph cluster_heater_switch {
			label="heater_switch";
			heater_switch_com [label="com"];
			heater_switch_spa [style=dashed, label="spa"];
			heater_switch_pool [color=red, label="pool"];

			heater_switch_com -> heater_switch_pool [color=red, style=dotted];
			heater_switch_com -> heater_switch_spa [style=dotted];
		}
		pump_stop [color=orange];

		// wires DONE:
		in_valve_black -> ac24v_neutral [style=dashed, color=brown];
		out_valve_black -> ac24v_neutral [style=dashed, color=brown];
		ac24v_line -> stop_switch_com [style=dashed, color=blue];
		stop_switch_no -> pump_stop [style=dashed, color=orange, weight=0];
		// stop_switch_no -> in_switch_com [style=dashed, color=orange];
		// stop_switch_no -> out_switch_com [style=dashed, color=orange];
		in_switch_red -> in_valve_red [style=dashed, color=red];
		in_switch_white -> in_valve_white [style=dashed];
		out_switch_red -> out_valve_red [style=dashed, color=red];
		out_switch_white -> out_valve_white [style=dashed];
		pump_stop -> ac24v_neutral [style=dashed, color=brown, weight=0];
	// }

	// subgraph cluster_5v {
		// label="DC 5v";
		// subgraph cluster_arduino {
			// label="arduino";
		
			// pin_d1;
			// pin_d2;
			// pin_d3;
			// pin_d4;
			// pin_d5;
			// pin_d6;
			pin_d7 [color=orangered, label="cleaner_pump (d7)"];
			pin_d8 [color=orange, label="stop (d8)"];
			pin_d9 [color=red, label="in_pool (d9)"];
			pin_d10 [style=dashed, label="in_spa (d10)"];
			pin_d11 [color=red, label="out_pool (d11)"];
			pin_d12 [style=dashed, label="out_spa (d12)"];
			pin_a0 [color=green, label="flow (a0)"];
			pin_a1 [label="valve current sens (a1)"];
			// pin_a2;
			// pin_a3;
			pin_a4 [color=purple, label="sda (a4)"];
			pin_a5 [color=purple, label="scl (a5)"];
			// pin_a6;
			// pin_a7;
			pin_vcc [color=yellow];
			pin_gnd [color=dimgray];
		// }

		flow_switch [color=green];

		subgraph  cluster_i2c {
			label="i2c";
			color=purple;
			sda [color=purple];
			scl [color=purple];

			RTC [color=purple];
			lcd_display [color=purple];
			rotary_encoder [color=purple, style=dotted];

			sda -> lcd_display [color=purple, style=dotted];
			scl -> lcd_display [color=purple, style=dotted];
			RTC, rotary_encoder -> sda [color=purple, style=dotted];
			RTC, rotary_encoder -> scl [color=purple, style=dotted];
		}
		pin_a4 -> sda [color=purple, style=dotted];
		sda -> pin_a4 [color=purple, style=dotted];
		pin_a5 -> scl [color=purple, style=dotted];
		// scl -> pin_a5 [color=purple, style=dotted];
		

		dc_5v -> flow_switch [color=yellow, weight=0];
	
		// dc_5v -> pin_vcc [color=yellow];
		// pin_gnd -> dc_gnd [color=dimgray];
		flow_switch -> pin_a0 [style=dotted, color=green, weight=0];
	// }

	// subgraph cluster_relay_0 {
		// label="relay 0";
		// r0_dc_in [color=yellow];
		// r0_dc_gnd [color=dimgray];

		subgraph cluster_r0ch0 {
			label="stop (r0ch0)";
			r0_in_0 [color=orange, label="in_0"];
			r0_com_0 [color=orange, label="com_0"];
			r0_no_0 [color=orange, label="no_0"];
			r0_nc_0 [color=orange, label="nc_0"];
		}
		subgraph cluster_r0ch1 {
			label="flow (r0ch1, active low)";
			r0_in_1 [color=green, label="in_1"];
			r0_com_1 [color=green, label="com_1"];
			r0_no_1 [color=green, label="no_1"];
			r0_nc_1 [color=green, label="nc_1"];
		}
		
		// subgraph cluster_r0ch2 {
		// 	label="ch1";
		// 	r0_in_2;
		// 	r0_com_2;
		// 	r0_no_2;
		// 	r0_nc_2;
		
		// }
		// subgraph cluster_r0ch3 {
		// 	label="ch3";
		// 	r0_in_3;
		// 	r0_com_3;
		// 	r0_no_3;
		// 	r0_nc_3;
		// }
		
		# ch0 is pump_stop
		r0_com_0 -> r0_nc_0 [color=orange, style=dashed, penwidth=2];
		r0_com_0 -> r0_no_0 [color=orange, style=dashed];
		r0_in_0 -> r0_com_0 [color=orange, style=dotted];
		

		# ch1 is flow switch
		r0_com_1 -> r0_nc_1 [color=green, style=dashed, penwidth=2];
		r0_com_1 -> r0_no_1 [color=green, style=dashed];
		r0_in_1 -> r0_com_1 [color=green, style=dotted];
		
		// r0_com_2 -> r0_nc_2 [style=dashed, penwidth=2];
		// r0_com_2 -> r0_no_2 [style=dashed];
		// r0_in_2 -> r0_com_2 [style=dotted];
		
		// r0_com_3 -> r0_nc_3 [style=dashed, penwidth=2];
		// r0_com_3 -> r0_no_3 [style=dashed];
		// r0_in_3 -> r0_com_3 [style=dotted];

	// }

	// subgraph cluster_relay_1 {
	// 	label="relay 1";
		// r1_dc_in [color=yellow];
		// r1_dc_gnd [color=dimgray];

		subgraph cluster_r1ch0 {
			label="in_pool (r1ch0)";
			r1_in_0 [color=red, label="in_0"];
			r1_com_0 [color=red, label="com_0"];
			r1_no_0 [color=red, label="no_0"];
			r1_nc_0 [color=red, label="nc_0"];
		}
		subgraph cluster_r1ch1 {
			label="in_spa (r1ch1)";
			r1_in_1 [style=dashed, label="in_1"];
			r1_com_1 [style=dashed, label="com_1"];
			r1_no_1 [style=dashed, label="no_1"];
			r1_nc_1 [style=dashed, label="nc_1"];
		}
		subgraph cluster_r1ch2 {
			label="out_pool (r1ch2)";
			r1_in_2 [color=red, label="in_2"];
			r1_com_2 [color=red, label="com_2"];
			r1_no_2 [color=red, label="no_2"];
			r1_nc_2 [color=red, label="nc_2"];
		}
		subgraph cluster_r1ch3 {
			label="out_spa (r1ch3)";
			r1_in_3 [style=dashed, label="in_3"];
			r1_com_3 [style=dashed, label="com_3"];
			r1_no_3 [style=dashed, label="no_3"];
			r1_nc_3 [style=dashed, label="nc_3"];
		}
		// ch0 is in valve red (pool)
		r1_com_0 -> r1_nc_0 [color=red, style=dashed, penwidth=2];
		r1_com_0 -> r1_no_0 [color=red, style=dashed];
		r1_in_0 -> r1_com_0 [color=red, style=dotted];
		
		// ch1 is in valve white (spa)
		r1_com_1 -> r1_nc_1 [style=dashed, penwidth=2];
		r1_com_1 -> r1_no_1 [style=dashed];
		r1_in_1 -> r1_com_1 [style=dotted];
		
		// ch2 is out red (pool)
		r1_com_2 -> r1_nc_2 [color=red, style=dashed, penwidth=2];
		r1_com_2 -> r1_no_2 [color=red, style=dashed];
		r1_in_2 -> r1_com_2 [color=red, style=dotted];
		
		// ch3 is out white (spa)
		r1_com_3 -> r1_nc_3 [style=dashed, penwidth=2];
		r1_com_3 -> r1_no_3 [style=dashed];
		r1_in_3 -> r1_com_3 [style=dotted];

		// Partial feedback for exclusive operation
		r1_nc_0 -> r1_com_1 [style=dashed];
		r1_nc_2 -> r1_com_3 [style=dashed];
	// }

	subgraph cluster_relay_2 {
		label="relay 2";
		// r2_dc_in [color=yellow];
		// r2_dc_gnd [color=dimgray];

		subgraph cluster_r2ch0 {
			label="cleaner_pump_l1 (r2ch0)";
			r2_in_0 [color=orangered, label="in_0"];
			r2_com_0 [color=orangered, label="com_0"];
			r2_no_0 [color=orangered, label="no_0"];
			r2_nc_0 [color=orangered, label="nc_0"];
		}
		subgraph cluster_r2ch1 {
			label="cleaner_pump_l2 (r2ch1)";
			r2_in_1 [color=orangered, label="in_1"];
			r2_com_1 [color=orangered, label="com_1"];
			r2_no_1 [color=orangered, label="no_1"];
			r2_nc_1 [color=orangered, label="nc_1"];
		}
		// subgraph cluster_r2ch2 {
		// 	label="ch1";
		// 	r2_in_2;
		// 	r2_com_2;
		// 	r2_no_2;
		// 	r2_nc_2;
		
		// }
		// subgraph cluster_r2ch3 {
		// 	label="ch3";
		// 	r2_in_3;
		// 	r2_com_3;
		// 	r2_no_3;
		// 	r2_nc_3;
		// }
		# ch0 is flow switch
		r2_com_0 -> r2_nc_0 [color=orangered, style=dashed, penwidth=2];
		r2_com_0 -> r2_no_0 [color=orangered, style=dashed];
		r2_in_0 -> r2_com_0 [color=orangered, style=dotted];
		
		# ch2 is pump_stop
		r2_com_1 -> r2_nc_1 [color=orangered, style=dashed, penwidth=2];
		r2_com_1 -> r2_no_1 [color=orangered, style=dashed];
		r2_in_1 -> r2_com_1 [color=orangered, style=dotted];
		
		// r2_com_2 -> r2_nc_2 [style=dashed, penwidth=2];
		// r2_com_2 -> r2_no_2 [style=dashed];
		// r2_in_2 -> r2_com_2 [style=dotted];
		
		// r2_com_3 -> r2_nc_3 [style=dashed, penwidth=2];
		// r2_com_3 -> r2_no_3 [style=dashed];
		// r2_in_3 -> r2_com_3 [style=dotted];

	}

	subgraph cluster_valve_current_sensor {
		label="valve_current_sensor";
		valve_cur_sens_a;
		valve_cur_sens_b;
		valve_cur_sens_gnd [color=dimgray];
		valve_cur_sens_vcc [color=yellow];
		valve_cur_sens_out;
	}

	valve_cur_sens_out -> pin_a1 [style=dotted];

	// ac110v_line1 -> transformer [style=dashed];
	// transformer -> ac110v_neutral [style=dashed];
	// transformer -> ac24v_line [style=dashed, color=blue];
	// ac24v_neutral -> transformer [style=dashed, color=brown];

	// cleaner_pump -> ac110v_neutral [style=dashed];

	// dc_5v -> r0_dc_in [color=yellow];
	// r0_dc_gnd -> dc_gnd [color=dimgray];
	// dc_5v -> r1_dc_in [color=yellow];
	// r1_dc_gnd -> dc_gnd [color=dimgray];

	pin_d8 -> r0_in_0 [style=dotted];
	pin_d9 -> r1_in_0 [style=dotted, color=red];
	pin_d10 -> r1_in_1 [style=dotted];
	pin_d11 -> r1_in_2 [style=dotted, color=red];
	pin_d12 -> r1_in_3 [style=dotted];
	
	r1_no_0 -> in_switch_red [style=dashed, color=red];
	r1_no_1 -> in_switch_white [style=dashed];
	r1_no_2 -> out_switch_red [style=dashed, color=red];
	r1_no_3 -> out_switch_white [style=dashed];

	stop_switch_no -> r0_com_1 [style=dashed, color=orange];
	flow_switch -> r0_in_1 [style=dotted, color=green, weight=0];
	r0_no_1 -> valve_cur_sens_a [style=dashed, color=green];

	stop_switch_com -> r0_com_0 [style=dashed, color=blue];
	r0_no_0 -> stop_switch_no [style=dashed, color=orange];
	// stop_switch_no -> valve_cur_sens_a [style=dashed, color=orange];
	valve_cur_sens_b -> in_switch_com [style=dashed, color=green];
	in_switch_com -> out_switch_com [style=dashed, color=green];
	in_switch_com -> r1_com_0 [style=dashed, color=green];
	out_switch_com -> r1_com_2 [style=dashed, color=green];
	// r1_com_0 -> r1_com_2 [color=green, style=dashed];

	// pump_stop -> vsp_pump [style=dotted, color=orange, weight=0];
	ac110v_line1 -> r2_com_0 [style=dashed, color=orangered];
	ac110v_line2 -> r2_com_1 [style=dashed, color=orangered];
	r2_in_0 -> r2_in_1 [style=dotted, color=orangered];
	r2_no_0 -> cleaner_pump [color=orangered, style=dashed];
	r2_no_1 -> cleaner_pump [color=orangered, style=dashed];
	cleaner_pump -> ac110v_neutral [style=dashed];

	pin_d7 -> r2_in_0 [style=dotted, color=orangered];
}